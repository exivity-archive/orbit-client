{"remainingRequest":"c:\\code\\exivity\\orbit-client\\node_modules\\babel-loader\\lib\\index.js?{\"presets\":[[\"@babel/preset-env\",{\"useBuiltIns\":\"entry\",\"modules\":false}],\"@babel/preset-react\",[\"c:\\\\code\\\\exivity\\\\orbit-client\\\\node_modules\\\\docz\\\\node_modules\\\\babel-preset-docz\\\\dist\\\\index.js\",{\"flow\":true,\"typescript\":false,\"parseProps\":true}]],\"plugins\":[\"@babel/plugin-proposal-class-properties\",\"babel-plugin-styled-components\",[\"c:\\\\code\\\\exivity\\\\orbit-client\\\\node_modules\\\\docz-utils\\\\lib\\\\named-asset-import.js\",{\"loaderMap\":{\"svg\":{\"ReactComponent\":\"@svgr/webpack?-prettier,-svgo![path]\"}}}],\"c:\\\\code\\\\exivity\\\\orbit-client\\\\node_modules\\\\docz\\\\node_modules\\\\react-hot-loader\\\\babel.js\"],\"env\":{\"test\":{\"presets\":[\"@babel/preset-env\",\"@babel/preset-react\"]}},\"cacheDirectory\":true,\"babelrc\":false}!c:\\code\\exivity\\orbit-client\\src\\components\\Collection.js","dependencies":[{"path":"c:\\code\\exivity\\orbit-client\\src\\components\\Collection.js","mtime":1549006539244},{"path":"c:\\code\\exivity\\orbit-client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1543011188795},{"path":"c:\\code\\exivity\\orbit-client\\node_modules\\babel-loader\\lib\\index.js","mtime":1542804666583}],"contextDependencies":[],"result":["(function () {\n  var enterModule = require('react-hot-loader').enterModule;\n\n  enterModule && enterModule(module);\n})();\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport { withData } from 'react-orbitjs';\nimport pluralize from 'pluralize';\nimport decorateQuery from '../utils/decorateQuery';\nimport { getIdsFromRelatedCollection, getRelatedRecords, findRelatedRecords, memoizedCollectionAndHelpers } from '../utils/selectors';\nexport var notAllowedPropsCollection = ['id', 'type', 'related', 'relatedTo', 'children', 'queryStore', 'updateStore', 'plural', 'cache', 'filter', 'sort', 'page', 'queryOptions'];\n\nvar Collection =\n/*#__PURE__*/\nfunction (_PureComponent) {\n  _inherits(Collection, _PureComponent);\n\n  function Collection(props) {\n    var _this$state;\n\n    var _this;\n\n    _classCallCheck(this, Collection);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Collection).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"isControlled\", function (prop) {\n      return _this.props[prop] !== undefined ? _this.props[prop] : _this.state[prop];\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"isRelatedToCollection\", function () {\n      return !!(_this.props.related && Array.isArray(_this.props.relatedTo));\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"checkRelations\", function (collection) {\n      var _this$props = _this.props,\n          type = _this$props.type,\n          relatedTo = _this$props.relatedTo;\n\n      if (_this.isRelatedToCollection()) {\n        var relatedIds = getIdsFromRelatedCollection(relatedTo, type);\n        return findRelatedRecords(collection, relatedIds);\n      }\n\n      return collection;\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"startQuery\", function (query) {\n      _this.setState({\n        loading: true,\n        error: false\n      }, query);\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"query\", function () {\n      var _this$props2 = _this.props,\n          related = _this$props2.related,\n          relatedTo = _this$props2.relatedTo,\n          type = _this$props2.type,\n          sort = _this$props2.sort,\n          filter = _this$props2.filter,\n          page = _this$props2.page;\n\n      if (related && relatedTo && !_this.isRelatedToCollection()) {\n        return function (query) {\n          return query.findRelatedRecords({\n            type: relatedTo.type,\n            id: relatedTo.id\n          }, _this.pluralizedType);\n        };\n      }\n\n      return decorateQuery(function (query) {\n        return query.findRecords(type);\n      }, {\n        sort: sort,\n        filter: filter,\n        page: page\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"queryStore\", function () {\n      _this.props.queryStore(_this.query(), _this.props.queryOptions).then(_this.checkRelations).then(function (collection) {\n        var _this$setState;\n\n        return _this.setState((_this$setState = {}, _defineProperty(_this$setState, _this.pluralizedType, collection), _defineProperty(_this$setState, \"loading\", false), _this$setState));\n      }).catch(function (error) {\n        _this.setState({\n          loading: false,\n          error: error\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"buildSaveTransforms\", function (collection) {\n      return function (t) {\n        return collection.map(function (record) {\n          if (record.id) {\n            return t.replaceRecord(record);\n          }\n\n          return t.addRecord(record);\n        });\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"buildRemoveTransforms\", function (collection) {\n      return function (t) {\n        return collection.map(function (record) {\n          return t.removeRecord(record);\n        });\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"getRelatedTo\", function () {\n      var _this$props3 = _this.props,\n          related = _this$props3.related,\n          relatedTo = _this$props3.relatedTo;\n\n      var collection = _this.isControlled(_this.pluralizedType);\n\n      if (relatedTo) return relatedTo;\n      if (related && !relatedTo) return null;\n\n      if (!related && !relatedTo) {\n        return collection.length ? collection : null;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"getCollectionAndHelpers\", function () {\n      return memoizedCollectionAndHelpers({\n        props: _this.props,\n        state: _this.state,\n        collection: _this.isControlled(_this.pluralizedType),\n        buildSaveTransforms: _this.buildSaveTransforms,\n        buildRemoveTransforms: _this.buildRemoveTransforms,\n        pluralizedType: _this.pluralizedType\n      });\n    });\n\n    _this.pluralizedType = props.plural || pluralize(props.type);\n    _this.state = (_this$state = {}, _defineProperty(_this$state, _this.pluralizedType, []), _defineProperty(_this$state, \"loading\", false), _defineProperty(_this$state, \"error\", false), _this$state);\n    return _this;\n  }\n\n  _createClass(Collection, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this$props4 = this.props,\n          related = _this$props4.related,\n          relatedTo = _this$props4.relatedTo,\n          cache = _this$props4.cache;\n      if (cache === 'only') return null;\n      if (related && relatedTo || !related) this.startQuery(this.queryStore);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var relatedToRecordOrCollection = this.getRelatedTo();\n      var extendedCollection = this.getCollectionAndHelpers();\n\n      if (typeof this.props.children !== 'function') {\n        // Child is component\n        return React.cloneElement(this.props.children, _objectSpread({}, extendedCollection, {\n          relatedTo: relatedToRecordOrCollection\n        }));\n      } // Child is a function\n\n\n      return this.props.children(extendedCollection);\n    }\n  }, {\n    key: \"__reactstandin__regenerateByEval\",\n    // @ts-ignore\n    value: function __reactstandin__regenerateByEval(key, code) {\n      // @ts-ignore\n      this[key] = eval(code);\n    }\n  }]);\n\n  return Collection;\n}(PureComponent);\n\nvar mapRecordsToProps = function mapRecordsToProps(_ref) {\n  var type = _ref.type,\n      plural = _ref.plural,\n      cache = _ref.cache,\n      related = _ref.related,\n      relatedTo = _ref.relatedTo,\n      sort = _ref.sort,\n      filter = _ref.filter,\n      page = _ref.page;\n  var pluralizedType = plural || pluralize(type);\n\n  if (related && Array.isArray(relatedTo)) {\n    return _defineProperty({}, pluralizedType, function (q) {\n      return q.findRecords(type);\n    });\n  }\n\n  if (related && relatedTo) {\n    return _defineProperty({}, pluralizedType, function (q) {\n      return q.findRelatedRecords({\n        type: relatedTo.type,\n        id: relatedTo.id\n      }, pluralizedType);\n    });\n  }\n\n  if (!related) {\n    return _defineProperty({}, pluralizedType, decorateQuery(function (q) {\n      return q.findRecords(type);\n    }, {\n      sort: sort,\n      filter: filter,\n      page: page\n    }));\n  }\n\n  return {};\n}; // Temp workaround for react-orbitjs not being able to handle other returns then functions\n\n\nvar mergeProps = function mergeProps(record, ownProps) {\n  var pluralizedType = ownProps.plural || pluralize(ownProps.type);\n\n  if (ownProps.related && Array.isArray(ownProps.relatedTo)) {\n    var collection = getRelatedRecords({\n      ownProps: ownProps,\n      record: record,\n      pluralizedType: pluralizedType\n    });\n    return _objectSpread({}, record, ownProps, _defineProperty({}, pluralizedType, collection));\n  }\n\n  if (ownProps.related && !ownProps.relatedTo) {\n    return _objectSpread({}, record, ownProps, _defineProperty({}, pluralizedType, []));\n  }\n\n  return _objectSpread({}, record, ownProps);\n};\n\nexport { Collection };\n\nvar _default = withData(mapRecordsToProps, mergeProps)(Collection);\n\nexport default _default;\nCollection.displayName = 'Collection';\nCollection.defaultProps = {\n  cache: 'skip'\n};\nCollection.propTypes = {\n  type: PropTypes.string,\n  plural: PropTypes.string,\n  related: PropTypes.bool,\n  relatedTo: PropTypes.oneOfType([PropTypes.object, PropTypes.array]),\n  cache: PropTypes.oneOf(['only', 'skip']),\n  queryStore: PropTypes.func.isRequired,\n  updateStore: PropTypes.func.isRequired,\n  sort: PropTypes.oneOfType([PropTypes.string, PropTypes.object]),\n  filter: PropTypes.oneOfType([PropTypes.string, PropTypes.object]),\n  page: PropTypes.oneOfType([PropTypes.number, PropTypes.object])\n};\n;\n\n(function () {\n  var reactHotLoader = require('react-hot-loader').default;\n\n  var leaveModule = require('react-hot-loader').leaveModule;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(notAllowedPropsCollection, \"notAllowedPropsCollection\", \"c:\\\\code\\\\exivity\\\\orbit-client\\\\src\\\\components\\\\Collection.js\");\n  reactHotLoader.register(Collection, \"Collection\", \"c:\\\\code\\\\exivity\\\\orbit-client\\\\src\\\\components\\\\Collection.js\");\n  reactHotLoader.register(mapRecordsToProps, \"mapRecordsToProps\", \"c:\\\\code\\\\exivity\\\\orbit-client\\\\src\\\\components\\\\Collection.js\");\n  reactHotLoader.register(mergeProps, \"mergeProps\", \"c:\\\\code\\\\exivity\\\\orbit-client\\\\src\\\\components\\\\Collection.js\");\n  reactHotLoader.register(_default, \"default\", \"c:\\\\code\\\\exivity\\\\orbit-client\\\\src\\\\components\\\\Collection.js\");\n  leaveModule(module);\n})();\n\n;\nCollection.__docgenInfo = {\n  \"description\": \"\",\n  \"methods\": [{\n    \"name\": \"isControlled\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [{\n      \"name\": \"prop\",\n      \"type\": null\n    }],\n    \"returns\": null\n  }, {\n    \"name\": \"isRelatedToCollection\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [],\n    \"returns\": null\n  }, {\n    \"name\": \"checkRelations\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [{\n      \"name\": \"collection\",\n      \"type\": null\n    }],\n    \"returns\": null\n  }, {\n    \"name\": \"startQuery\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [{\n      \"name\": \"query\",\n      \"type\": null\n    }],\n    \"returns\": null\n  }, {\n    \"name\": \"query\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [],\n    \"returns\": null\n  }, {\n    \"name\": \"queryStore\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [],\n    \"returns\": null\n  }, {\n    \"name\": \"buildSaveTransforms\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [{\n      \"name\": \"collection\",\n      \"type\": null\n    }],\n    \"returns\": null\n  }, {\n    \"name\": \"buildRemoveTransforms\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [{\n      \"name\": \"collection\",\n      \"type\": null\n    }],\n    \"returns\": null\n  }, {\n    \"name\": \"getRelatedTo\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [],\n    \"returns\": null\n  }, {\n    \"name\": \"getCollectionAndHelpers\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [],\n    \"returns\": null\n  }],\n  \"displayName\": \"Collection\",\n  \"props\": {\n    \"cache\": {\n      \"defaultValue\": {\n        \"value\": \"'skip'\",\n        \"computed\": false\n      },\n      \"type\": {\n        \"name\": \"enum\",\n        \"value\": [{\n          \"value\": \"'only'\",\n          \"computed\": false\n        }, {\n          \"value\": \"'skip'\",\n          \"computed\": false\n        }]\n      },\n      \"required\": false,\n      \"description\": \"\"\n    },\n    \"type\": {\n      \"type\": {\n        \"name\": \"string\"\n      },\n      \"required\": false,\n      \"description\": \"\"\n    },\n    \"plural\": {\n      \"type\": {\n        \"name\": \"string\"\n      },\n      \"required\": false,\n      \"description\": \"\"\n    },\n    \"related\": {\n      \"type\": {\n        \"name\": \"bool\"\n      },\n      \"required\": false,\n      \"description\": \"\"\n    },\n    \"relatedTo\": {\n      \"type\": {\n        \"name\": \"union\",\n        \"value\": [{\n          \"name\": \"object\"\n        }, {\n          \"name\": \"array\"\n        }]\n      },\n      \"required\": false,\n      \"description\": \"\"\n    },\n    \"queryStore\": {\n      \"type\": {\n        \"name\": \"func\"\n      },\n      \"required\": true,\n      \"description\": \"\"\n    },\n    \"updateStore\": {\n      \"type\": {\n        \"name\": \"func\"\n      },\n      \"required\": true,\n      \"description\": \"\"\n    },\n    \"sort\": {\n      \"type\": {\n        \"name\": \"union\",\n        \"value\": [{\n          \"name\": \"string\"\n        }, {\n          \"name\": \"object\"\n        }]\n      },\n      \"required\": false,\n      \"description\": \"\"\n    },\n    \"filter\": {\n      \"type\": {\n        \"name\": \"union\",\n        \"value\": [{\n          \"name\": \"string\"\n        }, {\n          \"name\": \"object\"\n        }]\n      },\n      \"required\": false,\n      \"description\": \"\"\n    },\n    \"page\": {\n      \"type\": {\n        \"name\": \"union\",\n        \"value\": [{\n          \"name\": \"number\"\n        }, {\n          \"name\": \"object\"\n        }]\n      },\n      \"required\": false,\n      \"description\": \"\"\n    }\n  }\n};",{"version":3,"sources":["c:\\code\\exivity\\orbit-client\\src\\components\\Collection.js"],"names":["React","PureComponent","PropTypes","withData","pluralize","decorateQuery","getIdsFromRelatedCollection","getRelatedRecords","findRelatedRecords","memoizedCollectionAndHelpers","notAllowedPropsCollection","Collection","props","prop","undefined","state","related","Array","isArray","relatedTo","collection","type","isRelatedToCollection","relatedIds","query","setState","loading","error","sort","filter","page","id","pluralizedType","findRecords","queryStore","queryOptions","then","checkRelations","catch","t","map","record","replaceRecord","addRecord","removeRecord","isControlled","length","buildSaveTransforms","buildRemoveTransforms","plural","cache","startQuery","relatedToRecordOrCollection","getRelatedTo","extendedCollection","getCollectionAndHelpers","children","cloneElement","mapRecordsToProps","q","mergeProps","ownProps","displayName","defaultProps","propTypes","string","bool","oneOfType","object","array","oneOf","func","isRequired","updateStore","number"],"mappings":"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","sourcesContent":["import React, { PureComponent } from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport { withData } from 'react-orbitjs'\r\nimport pluralize from 'pluralize'\r\n\r\nimport decorateQuery from '../utils/decorateQuery'\r\n\r\nimport {\r\n  getIdsFromRelatedCollection,\r\n  getRelatedRecords,\r\n  findRelatedRecords,\r\n  memoizedCollectionAndHelpers\r\n} from '../utils/selectors'\r\n\r\nexport const notAllowedPropsCollection = ['id', 'type', 'related', 'relatedTo', 'children', 'queryStore', 'updateStore', 'plural',\r\n  'cache', 'filter', 'sort', 'page', 'queryOptions']\r\n\r\nclass Collection extends PureComponent {\r\n  constructor (props) {\r\n    super (props)\r\n\r\n    this.pluralizedType = props.plural || pluralize(props.type)\r\n\r\n    this.state = {\r\n      [this.pluralizedType]: [],\r\n      loading: false,\r\n      error: false\r\n    }\r\n  }\r\n\r\n  componentDidMount () {\r\n    const { related, relatedTo, cache } = this.props\r\n\r\n    if (cache === 'only') return null\r\n    if (related && relatedTo || !related) this.startQuery(this.queryStore)\r\n  }\r\n\r\n  isControlled = (prop) => this.props[prop] !== undefined ? this.props[prop] : this.state[prop]\r\n\r\n  isRelatedToCollection = () => !!(this.props.related && Array.isArray(this.props.relatedTo))\r\n\r\n  checkRelations = (collection) => {\r\n    const { type, relatedTo } = this.props\r\n\r\n    if (this.isRelatedToCollection()) {\r\n      const relatedIds = getIdsFromRelatedCollection(relatedTo, type)\r\n      return findRelatedRecords(collection, relatedIds)\r\n    }\r\n\r\n    return collection\r\n  }\r\n\r\n  startQuery = (query) => {\r\n    this.setState({\r\n      loading: true,\r\n      error: false,\r\n    }, query)\r\n  }\r\n\r\n  query = () => {\r\n    const { related, relatedTo, type, sort, filter, page } = this.props\r\n\r\n    if (related && relatedTo && !this.isRelatedToCollection()) {\r\n      return (query) => query.findRelatedRecords({ type: relatedTo.type, id: relatedTo.id }, this.pluralizedType)\r\n    }\r\n\r\n    return  decorateQuery((query) => query.findRecords(type), { sort, filter, page })\r\n  }\r\n\r\n  queryStore = () => {\r\n    this.props.queryStore(this.query(), this.props.queryOptions)\r\n      .then(this.checkRelations)\r\n      .then((collection) => this.setState({\r\n        [this.pluralizedType]: collection,\r\n        loading: false\r\n      }))\r\n      .catch((error) => {\r\n        this.setState({\r\n          loading: false,\r\n          error\r\n        })\r\n      })\r\n  }\r\n\r\n  buildSaveTransforms = (collection) => (t) => collection.map((record) => {\r\n    if (record.id) {\r\n      return t.replaceRecord(record)\r\n    }\r\n\r\n    return t.addRecord(record)\r\n  })\r\n\r\n  buildRemoveTransforms = (collection) => (t) => collection.map((record) => {\r\n    return t.removeRecord(record)\r\n  })\r\n\r\n  getRelatedTo = () => {\r\n    const { related, relatedTo } = this.props\r\n    const collection = this.isControlled(this.pluralizedType)\r\n\r\n    if (relatedTo) return relatedTo\r\n    if (related && !relatedTo) return null\r\n    if (!related && !relatedTo) {\r\n      return collection.length ? collection : null\r\n    }\r\n  }\r\n\r\n  getCollectionAndHelpers = () => {\r\n    return memoizedCollectionAndHelpers({\r\n      props: this.props,\r\n      state: this.state,\r\n      collection: this.isControlled(this.pluralizedType),\r\n      buildSaveTransforms: this.buildSaveTransforms,\r\n      buildRemoveTransforms: this.buildRemoveTransforms,\r\n      pluralizedType: this.pluralizedType\r\n    })\r\n  }\r\n\r\n  render () {\r\n    const relatedToRecordOrCollection = this.getRelatedTo()\r\n    const extendedCollection = this.getCollectionAndHelpers()\r\n\r\n    if (typeof this.props.children !== 'function') {\r\n      // Child is component\r\n      return React.cloneElement(\r\n        this.props.children,\r\n        {\r\n          ...extendedCollection,\r\n          relatedTo: relatedToRecordOrCollection\r\n        }\r\n      )\r\n    }\r\n\r\n    // Child is a function\r\n    return this.props.children(extendedCollection)\r\n  }\r\n}\r\n\r\nconst mapRecordsToProps = ({ type, plural, cache, related, relatedTo, sort, filter, page }) => {\r\n  const pluralizedType = plural || pluralize(type)\r\n\r\n  if (related && Array.isArray(relatedTo)) {\r\n    return {\r\n      [pluralizedType]: q => q.findRecords(type)\r\n    }\r\n  }\r\n\r\n  if (related && relatedTo) {\r\n    return {\r\n      [pluralizedType]: q => q.findRelatedRecords({ type: relatedTo.type, id: relatedTo.id }, pluralizedType),\r\n    }\r\n  }\r\n\r\n  if (!related) {\r\n    return {\r\n      [pluralizedType]: decorateQuery(q => q.findRecords(type), { sort, filter, page }),\r\n    }\r\n  }\r\n\r\n  return {}\r\n}\r\n\r\n// Temp workaround for react-orbitjs not being able to handle other returns then functions\r\nconst mergeProps = (record, ownProps) => {\r\n  const pluralizedType = ownProps.plural || pluralize(ownProps.type)\r\n\r\n  if (ownProps.related && Array.isArray(ownProps.relatedTo)) {\r\n    const collection = getRelatedRecords({ ownProps, record, pluralizedType })\r\n    \r\n    return {\r\n      ...record,\r\n      ...ownProps,\r\n      [pluralizedType]: collection\r\n    }\r\n  }\r\n\r\n  if (ownProps.related && !ownProps.relatedTo) {\r\n    return {\r\n      ...record,\r\n      ...ownProps,\r\n      [pluralizedType]: []\r\n    }\r\n  }\r\n\r\n  return {\r\n    ...record,\r\n    ...ownProps\r\n  }\r\n}\r\n\r\nexport { Collection }\r\n\r\nexport default withData(mapRecordsToProps, mergeProps)(Collection)\r\n\r\nCollection.displayName = 'Collection'\r\n\r\nCollection.defaultProps = {\r\n  cache: 'skip',\r\n}\r\n\r\nCollection.propTypes = {\r\n  type: PropTypes.string,\r\n  plural: PropTypes.string,\r\n  related: PropTypes.bool,\r\n  relatedTo: PropTypes.oneOfType([\r\n    PropTypes.object,\r\n    PropTypes.array,\r\n  ]),\r\n  cache: PropTypes.oneOf([\r\n    'only',\r\n    'skip'\r\n  ]),\r\n  queryStore: PropTypes.func.isRequired,\r\n  updateStore: PropTypes.func.isRequired,\r\n  sort: PropTypes.oneOfType([\r\n    PropTypes.string,\r\n    PropTypes.object\r\n  ]),\r\n  filter: PropTypes.oneOfType([\r\n    PropTypes.string,\r\n    PropTypes.object\r\n  ]),\r\n  page: PropTypes.oneOfType([\r\n    PropTypes.number,\r\n    PropTypes.object\r\n  ])\r\n}\r\n"]}]}